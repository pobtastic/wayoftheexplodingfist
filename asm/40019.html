<!DOCTYPE html>
<html>
<head>
<title>The Way Of The Exploding Fist: Routine at 9C53</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
<link rel="stylesheet" type="text/css" href="../skoolkit-dark.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="39982.html">9C2E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#40019">Map</a></td>
<td class="next">
Next: <a href="40046.html">9C6E</a>
</td>
</tr>
</table>
<div class="description">9C53: Read Key Input.</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
Used by the routines at <a href="35924.html">GAME_CONFIGS_MAIN</a>, <a href="36059.html">GAME_CONFIGS_CONTROLS</a> and <a href="38725.html">JJJJ</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="40019"></span>
<div class="comments">
<div class="paragraph">
Annotated by Stephen Jones; Spectrum Discovery Club.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">KEYBOARD_TEST</td>
<td class="address-2"><span id="40019"></span>9C53</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Key to test in <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40020"></span>9C54</td>
<td class="instruction">AND $07</td>
<td class="comment-1" rowspan="1">Mask bits d0-d2 for row.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40022"></span>9C56</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">In range 1-8.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40023"></span>9C57</td>
<td class="instruction">LD B,A</td>
<td class="comment-1" rowspan="1">Place in <span class="register">B</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40024"></span>9C58</td>
<td class="instruction">SRL C</td>
<td class="comment-1" rowspan="3">Divide <span class="register">C</span> by 8 to find position within row.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40026"></span>9C5A</td>
<td class="instruction">SRL C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40028"></span>9C5C</td>
<td class="instruction">SRL C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40030"></span>9C5E</td>
<td class="instruction">LD A,$05</td>
<td class="comment-1" rowspan="1">Only 5 keys per row.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40032"></span>9C60</td>
<td class="instruction">SUB C</td>
<td class="comment-1" rowspan="1">Subtract position.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40033"></span>9C61</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Put into <span class="register">C</span>.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40034"></span>9C62</td>
<td class="instruction">LD A,$FE</td>
<td class="comment-1" rowspan="1">High byte of port to read.</td>
</tr>
<tr>
<td class="asm-label">KEYBOARD_FIND_ROW</td>
<td class="address-2"><span id="40036"></span>9C64</td>
<td class="instruction">RRCA</td>
<td class="comment-1" rowspan="1">Rotate into position.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40037"></span>9C65</td>
<td class="instruction">DJNZ <a href="40019.html#40036">KEYBOARD_FIND_ROW</a></td>
<td class="comment-1" rowspan="1">Repeat until we've found the relevant row.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40039"></span>9C67</td>
<td class="instruction">IN A,($FE)</td>
<td class="comment-1" rowspan="1">Read port (<span class="register">A</span>=high, 254=low).</td>
</tr>
<tr>
<td class="asm-label">KEYBOARD_ROTATE_LOOP</td>
<td class="address-2"><span id="40041"></span>9C69</td>
<td class="instruction">RRA</td>
<td class="comment-1" rowspan="1">Rotate bit out of result.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40042"></span>9C6A</td>
<td class="instruction">DEC C</td>
<td class="comment-1" rowspan="1">Loop counter.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40043"></span>9C6B</td>
<td class="instruction">JR NZ,<a href="40019.html#40041">KEYBOARD_ROTATE_LOOP</a></td>
<td class="comment-1" rowspan="1">Repeat until bit for position in carry flag.</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="40045"></span>9C6D</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return.</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="39982.html">9C2E</a>
</td>
<td class="up">Up: <a href="../maps/all.html#40019">Map</a></td>
<td class="next">
Next: <a href="40046.html">9C6E</a>
</td>
</tr>
</table>
<footer>
<div class="release"></div>
<div class="copyright">&copy; 1985 Melbourne House</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
</footer>
</body>
</html>